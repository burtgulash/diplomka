#!/usr/bin/sh

QUERY=${@:-srncu}
curl -s -XGET 'localhost:9200/csfd_trigram/_search' -d "$(echo '
{
    "min_score": 0.1,
    "size": 100,
    "query": {
        "bool": {
            "must": [
                 {
                    "multi_match": {
                        "query": "god",
                        "minimum_should_match": "50%",
                        "type": "most_fields",
                        "fields": [
                            "title.shorts",
                            "title.title",
                            "title.trigram"
                        ]
                    }
                 },
                 {
                    "multi_match": {
                        "query": "the",
                        "minimum_should_match": "50%",
                        "type": "most_fields",
                        "fields": [
                            "title.shorts",
                            "title.title",
                            "title.trigram"
                        ]
                    }
                 },
                 {
                    "multi_match": {
                        "query": "father",
                        "minimum_should_match": "50%",
                        "type": "most_fields",
                        "fields": [
                            "title.shorts",
                            "title.title",
                            "title.trigram"
                        ]
                    }
                 }
            ]
        }
    },
    "highlight": {
        "pre_tags": ["HLSTART"],
        "post_tags": ["HLEND"],
        "type": "fvh",
        "number_of_fragments": 0,
        "fields": {
            "title": {
                "matched_fields": [
                    "title.trigram",
                    "title.title",
                    "title.shorts"
                ]
            }
        }
    }
}'  | sed "s/QUERY/$QUERY/g")" \
| jq -r '.hits.hits[]._source.title' \
| tac \
#| ./trihigh.py $QUERY
