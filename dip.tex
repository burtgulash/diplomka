\documentclass[11pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[czech]{babel}
\usepackage{a4wide}
\usepackage[numbers]{natbib}
\usepackage[pdfborder={0 0 0},colorlinks=true,linkcolor=green]{hyperref}
\usepackage[bottom=2.8cm]{geometry}
%\usepackage{sectsty}

%\sectionfont{\fontsize{22}{22}\selectfont}
%\subsectionfont{\fontsize{14}{20}\selectfont}

\linespread{1.15}


\begin{document}
\section{Úvod}
Díky vzestupu počítačů a především internetu došlo k dramatickému nárustu
objemu textových informací ve formě snadno přístupné lidem i pro počítačové
zpracování. Textová data jsou specifická v tom, že jejími tvůrci jsou lidé a ne
počítačové systémy nebo měřící čidla. Při vyhledávání v takovýchto datech máme
jako lidé silná očekávání na relevanci výsledků vyhledávání, nicméně kvůli
charakteristice textových dat je vyhledávání v nich obtížné. Tím, že je úkol
obtížný, existuje více specifických zaměření, než jedno obecné a použitelné pro
všechny případy.

S nástupem World Wide Webu v 90. letech došlo k vzestupu Webových vyhledávačů,
které dnes slouží jako vstupní brána do světa informací.
...

V této práci se snažím najít alternativní způsoby v tomto širokém oboru, které
nejsou velmi známé, a zaměřím se na oblast, která je dle mého názoru jednou z
nejžádanějších v praktických aplikacích. V současné době se pro ni ale
používají techniky pro příliš obecné a zdrojově náročné prohledávání Webu a
nedosahují takových výsledků, jakých by mohly, nebo za příliš vysokou cenu
komplikovaných řešení. 

Velkým důvodem proč převažují techniky pro Webové vyhledávání je psychologický
- většina problémů, se kterými se potýkají firmy i nekomerční projekty, zdaleka
nepracuje s takovými objemy dat, se kterým se musí potýkat rozsáhlé webové
vyhledávače nebo světové sociální sítě. V praxi jsou tyto problémy často
řešitelné s použitím pouze jednoho počítače. Nicméně lidé přehnaně věří, že
jejich projekty budou jednou dosahovat obdobných závratných velikostí, a proto
volí řešení nevhodné pro jejich problémy.

V ideálním případě by měla být podpora pro efektivní textové vyhledávání
zabudována přímo do databázových systémů, ale v současné době není jejich
podpora ideální, a proto aplikace s podporou textového vyhledávání používají
kromě databáze ještě paralelní systém specializovaný pro text. Důvod je ten, že
je obtížné vytvořit vyhledávač v takové formě, aby vyhovoval obecným
požadavkům, na které se databáze používají. Techniky představené v této práci
by měly být vhodnější pro generické účely, než ty, které používají Webové
vyhledávače a ze kterých se čerpá inspirace pro textové indexy vestavěné do
databází.

...

V první části uvedu problém vyhledávání v textu, aby čtenář pochopil z jakého
základu tato práce vychází. V druhé části na současný stav v praktickém světě
textového vyhledávání a jak jsme se do něj dostali. Pak se zaměřím na algoritmy
a datové struktury textového vyhledávání a alternativní techniky, které jsou v
některých případech exotické a nepříliš vhodné na obecné použití, ale jiné
které by dle mého názoru zasloužily větší pozornost, protože jejich zaměření
odpovídá současným potřebám více, než na které je v dnešní době kladen největší
důraz. V další části rozeberu vybranou oblast textového vyhledávání více do
hloubky a popíšu problémy, které se v ní vyskytují. Zároveň rozeberu jejich
řešení různými výzkumnými týmy a můj návrh na řešení. V sekci Analýza
kvantitativně poukážu na konkrétní problémy popsané v předchozí sekci a
problémy implementace takového systému. Na závěr představím možná budoucí
řešení a další kroky k vylepšení, aby bylo možné vyhledávací systém nasadit v
praxi.


\section{Databáze a textové vyhledávání}
Textové vyhledávání se často uvádí odděleně od databázových systémů, přestože
by v ideálním případě mělo být součástí databází. Důvodem je silně různorodá
povaha textových dat s nejednoznačným způsobem zacházení. Pokud v databázích
pracujeme například s čísly, pak je situace celkem snadná, protože čísla jsou
snadno a jednoznačně porovnatelná, ať už to jsou floating nebo celá čísla. Díky
seřaditelnosti pak můžeme použít algoritmus binární vyhledávání, nebo
dynamickou obdobu v podobě binárních vyhledávacích stromů.

Jiné datové typy jako třeba intervaly jsou složitější, ale přesto existují
pevně definovatelné způsoby pro jejich seřazení a tedy snadné vyhledávání.
Intervalovými daty mohou být jednorozměrná časová rozmezí, dvourozměrná
geografická data, nebo vícerozměrná data často používaná v počítačové grafice.
Existuje pro ně velké množství relativně efektivních algoritmů a aktivní
výzkum. Časová data jsou na první pohled lehce seřaditelná, jenže kvůli lidským
"obohacením", jako jsou časové zóny, letní čas, nebo více dimenzí času (čas
platnosti, čas záznamu) se jejich zacházení v databázích komplikuje. Textová
data generovaná lidskou řečí jsou ještě komplikovanější a často se řeší mimo
databázové systémy. Ve výsledku používá spousta uživatelských aplikací s
databázovou podporou ve skutečnosti dva systémy - kromě klasické databáze ještě
speciální systém pro relevantní a efektivní textové vyhledávání.

Problém s textem, který nás zajímá, je jeho nejednoznačná seřaditelnost.
Představme si databázi lidských jmen a aplikaci určenou pro vyhledávání v nich.
Počítá se s tím, že pokud vyhledáváme konkrétní osobu, nevíme přesně jak je
její jméno v databázi uloženo. Kdybychom věděli, že se Jaromír Kobliha v
databázi vyskytuje v konkrétním tvaru Jaromír Kobliha nebo Kobliha, Jaromír
nebo Dr. Jarda Kobliha, pak jednoduše zadáme dotaz na přesnou shodu a máme
vyřešeno. Jenže naše očekávání jsou jiná. Člověk by všechny tyto tvary jména
vyhodnotil ekvivalentně, a tím pádem je naším úkolem vytvořit podobně chytrý
systém anebo alespoň iluzi takového systému. 

Jména mohou být jednoduše rozdělena na více sloupců - křestní jméno, prostřední
jméno, příjmení, titul(y), tak jak to známe, pokud vyplňujeme kdejaké
formuláře. To umožní systému provést oddělený dotaz v každém tomto sloupci a
sloučit výsledky. Nebo jména seřadit nejprve podle příjmení, pak podle jména a
titulů naposled (Kobliha, Jaromír, Dr.), protože předpokládáme, že existuje
méně příjmení než křestních jmen a ještě méně titulů. Tohle je ovšem jenom
heuristika, kterou nelze aplikovat např. ve Vietnamu (Nguyen a Tran tvoří 50\%
všech příjmení) nebo v Jižní Korey (Kim, Lee, Park a Choi tvoří 50\% všech
příjmení). Jiné kultury nemají ani koncept příjmení, proto je takový systém
obecně nedostatečný.

Pro větší záznamy - celé dokumenty o několika stovkách až tisících slov - nelze
ani uvažovat seřaditelnost podobně naivním způsobem. Přestože je vyhledávání v
textu obtížné, existují možnosti, jak povahu lidského textu využít a vytvořit
algoritmy umožňující efektivní vyhledávání.

Statisticky můžeme pozorovat unikátní povahu lidského jazyka v několika statistických pozorováních.
% Frekvenční analýza - codebreaking
% 1, 2,3 - více jedničěk distribuce
% zipf distribuce slov
% redundance - deflate a jiný textový komprese

\section{Současný stav a motivace ke změně}
Od dotcom bubliny v roce 2000 uplynulo už šestnáct let, Google nedávno
osmnácté narozeniny a od spuštění World Wide Webu uplynuly již téměř tři
desetiletí. V této kapitole nastíním situaci v textovém vyhledávání za
posledních zhruba dvacet let, některé nové trendy a subjektivní
zhodnocení současného stavu, které mě vedlo k této práci.

\subsection{Folklórní povědomí; Google, Stanford bias; nedostupnost populárních zdrojů (coursera, youtube)}
Právě populární folklórní povědomí o vyhledávání čerpá ze stejných , které čerpají
z běžně dostupných zdrojů.

\subsection{Situace v Open Source}
\subsection{Optimismus v Big Data}
S nástupem World 

\subsection{Big data vs Small data}
% popiš online processing (agrep), like operátor v databázi?
% regex search. Těžký pro uživatele. Nebere v potaz překlepy


\subsection{Optimismus v umělou inteligenci}
V dnešní době panuje velký optimismus z umělé inteligence a mnozí
předpovídají počítačové systémy schopné porozumět lidské řeči v
nejbližších letech až desetiletích. Nicméně při pohledu do historie
oboru umělé inteligence si můžeme povšimnout více podobných
optimistických období, které ale očekávání nenaplnily a po opadnutí
nadšení přišla tzv. zima v umělé inteligenci (AI winter). 


% Google + statistical bias + big data
% stuck at google's dominance
% bias toward statistical approaches and clever scraping
% some commercial systems and research is catching up
% open source is lagging behind
% what can be done

[1] \url{https://en.wikipedia.org/wiki/Information_retrieval#History}


[1] \url{https://www.theguardian.com/commentisfree/2015/apr/18/google-eu-monopoly-inquiry-too-late-to-stop}

\subsection{Open Source a komerční systémy}
% lucene, elastic, solr, algolia, xapian, mnogosearch, postgres

\subsection{Změny v architekturách počítačů a počítačových systémů}
% Stonebraker o databázích
% sloupcové a in-memory db
% něco o nosql
% hierarchie paměti
% ssd
% nvram

% konvergence db a fulltextu. Podobnost se sloupcovými db. Not yet because of
% reasons below. Columnar dbs for analytical slow access. tens of thousands
% columns needed for each word. If some words have short inverted list, then
% waste,because blocks have minimum size.

\subsection{Nové potřeby ve vyhledávání}
\subsection{Vertikální vyhledávání}
Dle hlavního vedoucího výzkumu v Googlu, Petera Norviga, je úspěch Googlu
založen ne na lepších algoritmech, než by měli ostatní, ale jednoduše tím, že
má více dat.
% přístup googlu - chytré scrapování. Přitom data existují ve zpracované formě.
% Nedostatek vertikálního a site search? Špatné nebo obtížné open source
% řešení? 
\subsection{Linked data}
\subsection{Mobilní zařízení}


\subsection{Algoritmy a datové struktury pro textové vyhledávání}
Algoritmy pro vyhledávání využívají právě této redundance v textu a díky tomu
dosahují daleko větší efektivity než o kdybychom u textu uvažovali rozvoměrné
rozložení.

\paragraph{Invertovaný index} \mbox{}\\
Centrální datovou strukturou, která využívá Zipfovy distribuce slov je datová
struktura invertovaný index (nebo také invertovaný soubor). Princip datové
struktury je ten, že pro každé slovo, které se vyskytuje v databázi, si uložíme
seznam odkazů na všechny záznamy (dokumenty), na kterých se slovo nachází.
Invertovaný index by měl být znám všem, kdo čtou knihy, protože rejstřík na
posledních stránkách není ničím jiným než právě invertovaným indexem, kde
jedním záznamem je stránka knihy a odkazem je číslo stránky. 

Invertovaný index jsou ve skutečnosti dvě datové struktury. Tou první je
takzvaný slovník - tedy seznam všech vyskytujících se slov s odkazem na svůj
příslušný seznam odkazů, neboli invertovaný seznam. Druhou strukturou je
samotný invertovaný soubor, což je soubor všech invertovaných seznamů.

Obě datové struktury mohou být implementovány různými způsoby podle druhu
použití a požadovaných vlastností. Kupříkladu obyčejná hashovací tabulka
poskytne velmi rychlý přístup k hledanému slovu ve slovníku, ale bude zabírat
relativně mnoho paměti, protože každý záznam v tabulce si musí uchovat samotný
text uloženého slova. V textovém vyhledávání, které často pracuje s velkými
objemy dat, bude vhodnější pouhý seřazený seznam slov, na který lze použít
binární vyhledávání. Odpadne nutnost ukládat pomocná data hashovací tabulky a
navíc lze použít jednoduchou kompresní metodu - tzv. front coding. Pořadí slova
v seřazeném seznamu lze použít jako odkaz pro nalezení odpovídajícího
invertovaného seznamu.

%\vspace{1cm}
%Příklad:
%
%\begin{center}
%\begin{tabular}{lr}
%\textbf{slovo}   & \textbf{ukazatel} \\
%\hline
%anderson          & 3  \\
%andrea            & 4  \\
%andulka           & 1  \\
%andy              & 2  \\
%kajak             & 13 \\ 
%kamna             & 14 \\
%karafiol          & 6  \\
%karate            & 12 \\ 
%karburátor        & 7  \\
%karel             & 11 \\
%karkulka          & 5  \\
%karma             & 8  \\
%karta             & 9  \\
%karty             & 10 \\ 
%\end{tabular}
%\end{center}

Pro ještě kompaktnější uložení se používá kompresní technika Front-Coding,
která využívá toho, že po sobě následující slova sdílí prefixy. Slovník se
rozdělí na bloky o konstantním počtu slov a prefix se pro tento blok uloží
zvlášť. Například při použití velikosti bloku 4 by slovník se slovy
\textbf{anderson, andrea, andulka, andy, kajak, kamna, karafiol, karate,
karburátor, karel, karkulka, karma, karta, karty} vypadal:
\textbf{\{and\}erson, rea, ulka, y | \{ka\}jak, mna, rafiol, rate | \{kar\}burátor, el, kulka, ma | \{kart\}a, y}

% TODO ukázka invertovaného indexu

\subsection{Alternativní datové struktury}
Invertovaný index je doposud vítězem v rychlosti vyhledávání v textu,
ale pro některé speciální případy byly navrženy i jiné datové struktury,
které dokáží být kompaktnější než invertovaný index po kompresi, nebo
umožňují vícero seřazení při jednom uložení v paměti. Klasický
invertovaný index má právě jedno seřazení - nejčastěji podle
vzrůstajícího id dokumentů nebo podle klesající zvolené business
metriky.

Waweletové stromy - dual sorted Index Treap Index

Obě tyto alternativní datové struktury dosahují obrovských úspor díky
své kompresibilitě, čehož bychom využili, pokud bychom uvažovali
rozsáhlá vstupní data. Ale protože se zaměřuji na relativně malé objemy
dat, avšak s vysokou redundancí při prohledávání, nevyužiji tyto datové
struktury. Dalším velkým důvodem je, že jsem nenašel žádný výzkum, který
by je aplikoval na prefixové, natož přibližné vyhledávání. Na druhou
stranu existuje více výzkumných týmů, kteří se zabývají přibližným
(fuzzy) prohledáváním na modifikovaném invertovaném indexu.

\section{Přibližné vyhledávání}
Rozdělení textu na slova a vytvoření datové struktury nad nimi je velkým
pokrokem od uvažování textu jako posloupnost znaků. Je to ale pouze první krok
k relevantním výsledkům. V této sekci poukáži na problémy invertovaného indexu
v jeho základní formě a několik způsobů, které řeší tyto problémy.

\paragraph{Jazyková morfologie}\mbox{}\\
Přestože podle jazykovědců mají všechny lidské jazyky společného předka
(Chomsky), historicky každý prošel svým unikátním vývojem a dnes má každý své
charakteristické rysy. Pro potřeby vyhledávání nás nezajímá jazykový syntax.
Strojové porozumění textu patří do kategorie problémů AI-Complete, tedy
potřebovali bychom k tomu obecnou umělou inteligenci. Více nás zajímají
problémy morfologie. Například morfologicky bohatá čeština je obtížná pro
algoritmické zpracování textu kvůli koncovkám slov. Například při dotazování
vyhledávače na výraz \textbf{motorová pila} nás jistě budou zajímat i výsledky,
které obsahují \textbf{motorové pile} nebo \textbf{motorových pilách}. Nelze po
uživateli požadovat, aby vyjmenoval všechny tvary slov, které zadává. Klasickým
řešením je před indexováním dat provést jazykovou analýzu a převést slova na
kořenový tvar. Ve výsledku se místo slova \textbf{motovorých} zaindexuje slovo
\textbf{motor} a poté při vyhledávání se provede tatáž konverze dotazovaných
slov. Vyhledávač by tedy původní výraz \textbf{motorová pila} nejprve převedl
na \textbf{motor pila} a vykonal dotaz s tímto modifikovaným výrazem.

Existuje mnoho obtíží s jazykovou analýzou. Jednak je závislá na konkrétním
jazyce. Může se stát, že některé datové kolekce obsahují záznamy ve více
jazycích. Pokud je text dostatečně dlouhý, lze to detekcí jazyka záznamu
frekvenční analýzou přes morfologickým rozborem. V jiném případě může datová
sada obsahovat záznamy v jednom jazyce, ale jednotlivá slova mohou být v jiném.
Pak jednoduchá frekvenční analýza nebude dostačovat a musíme zvolit složitější
techniky pro jazykový rozbor, které jsou mimo rozsah této práce.

Samotné převedení slov na kořenový tvar (lematizace, stematizace?) je velmi
náchylné k chybám a není stoprocentní. Například slovo \textbf{tancích} může
mít kořen \textbf{tank} nebo \textbf{tanec} podle významu slova, který by
člověk určil z kontextu věty. Tento problém naznačuje, že v úplnosti tento
problém opět patří do kategorie problémů vyžadujících obecnou umělou
inteligenci.

% Aglutinativní jazyky
\paragraph{N-gramové indexy}\mbox{}\\
Alternativou k invertovaným indexům, kde invertovaný seznam odpovídá jednomu
lidskému slovu, jsou tzv. n-gramové (q-gram?) invertované indexy. N-gramem je
posloupnost několika po sobě jdoucích písmen o konstantní velikosti $n$.
Například rozdělení výrazu \textbf{motor z hor} na trigramy (n-gram, kde $n =
3$) by bylo \textbf{\_\_m, \_mo, mot, oto, tor, or\_, r\_z, \_z\_, z\_h, \_ho,
hor, or\_, r\_\_}. V n-gramovém invertovaném indexu tedy vytvoříme invertovaný
seznam pro každý vyskytující se n-gram. N-gramy mají podobně jako slova zipfovo
rozdělení, proto je pro ně invertovaný index vhodnou datovou strukturou.
Velikou výhodu oproti slovnímu indexu je naprostá jazyková nezávislost a
podpora pro fuzzy vyhledávání.

Nezbytnou otázkou je, jak velké $n$ zvolit. % TODO

Databázový systém postgres podporuje trigramový index díky jeho univerzálnosti.

\subsection{Editovací vzdálenost}

\subsection{Prefixové indexy}
Ačkoliv se jedná o dva různé požadavky, prefixové a fuzzy invertované indexy
mají ve výsledku podobné vlastnosti a tudíž jsou pro ně vhodné stejné datové
struktury. Pokud na chvíli necháme fuzzy požavky stranou, nastíním, jak lze
jednoduše rozšířit klasický invertovaný index o podporu prefixového
vyhledávání.

Reprezentace seřazeným seznamem slov je obzvlášť vhodná pro prefixové
vyhledávání, protože v takovém případě stačí nalézt první a poslední slovo ve
slovníku, které odpovídají dotazovanému prefixu. Všechna slova mezi těmito
dvěma odpovídají na prefixový dotaz.

Přibližné vyhledávání slov je s prefixovým podobné, protože většina podobných
slov bude v seřazeném slovníku blízko u sebe. Pokud vyhledáváme přibližná slova
do vzdálenosti 1, pak několik slov se bude lišit v prvním písmenu od
dotazovaného, ale většina rozdílů bude v pozdějších částech slova, a tedy ve
výsledku budou relativně blízko u sebe.

Pro rychlý průchod slovníkem s přibližným prohledáváním se hodí datová
struktura \textbf{kompaktní trie}. Je to vlastně seřazený seznam slov s tím, že
všechny společné prefixy pro všechny skupiny slov jsou uloženy jako rodičovské
uzly stromu n-árního stromu. Tohle rozložení nám umožní rychle dohledat prefix
a všechny jeho potomci ve stromu jsou odpovědí na prefixový dotaz. Přibližné
vyhledávání je efektivní, protože výpočet vzdálenostní funkce se opětovně
použije u všech slov, které sdílí prefix.

Kompaktní trie (ve skutečnosti jakákoliv trie) nám umožní nejen rychlé
vyhledání všech slov odpovídajících prefixu, ale zároveň i rychlé přibližné
vyhledání všech podobných slov podle zvolené distanční metriky.


\subsection{Jiné techniky pro efektivnější vyhledávání}
\subsection{Autocompletion}
% query logs

\subsection{Type-ahead search, search as you go}

\url{https://swtch.com/~rsc/regexp/regexp4.html}

\section{Návrh implementace}
\subsection{Disjunkce invertovaných seznamů}
\subsection{Hybridní indexy}
\subsection{Indexace}
% 2-pass hybrid

\subsection{Ohodnocení výsledků dotazu}
\subsection{tf-idf}
% SEO - exploit of google's algorithms. Více vyhledávačů ztěžuje SEO
\subsection{Proximity}
% kritika tf-idf
% alternativa proximity


\section{Analýza}
\subsection{Použité datové soubory}
\subsection{Demonstrace hybridního indexu}
\subsection{Ukázka vyhledávání}

\section{Otevřené problémy a další postup}
\subsection{Statické a dynamické indexy}
% static: no locks and latches, compact data structures, cache efficient
% 2 level data structure + bulk updates
\subsection{Škálovatelnost}
% columnar storage
% document or term based
% share nothing
\subsection{Příliš krátký vstupní řetězec}
\subsection{Optimalizace plánování dotazů}


\section{Závěr}
Záměrem této práce je poukázat na alternativní přístupy v oblasti vyhledávání a
demonstrovat možný vyhledávací systém s alternativními technikami, který by byl
pro současné firemmní i nekomerční potřeby vhodnější, než systémy navrhované a
tvořené pro potřeby Webových vyhledávačů, které jsou však dnes nejrozšířenější.

\section{Odkazy}
\url{http://www.dcs.gla.ac.uk/~craigm/publications/lacour08efficiency.pdf}


\end{document}
